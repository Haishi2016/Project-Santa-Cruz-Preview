# Project Santa Cruz Secured AI Model Management

Welcome to Project Santa Cruz Secured AI Model Management (SCZ-SMM). This repository contains documents, sample scenarios and demo instructions for you to evaluate Santa Cruz Secured AI Model Management capabilities.

SCZ-SMM provides AI model protections [at rest](protection-at-rest.md), [during transition](protection-in-transition.md) and [in use](protection-in-use.md). It's designed to work with existing AI systems and workflows such as [Azure Machine Learning]( https://azure.microsoft.com/en-us/services/machine-learning/), [Azure Databricks]( https://azure.microsoft.com/en-us/services/databricks/), and [Azure Cognitive Services]( https://azure.microsoft.com/en-us/services/cognitive-services/). The long-term goal of SCZ-SMM is to provide a unified experience across underlying systems. 

This repository allows you to evaluate a few SCZ-SMM pieces that will eventually enable the unified experience.This kit contains a server and a Python SDK, as highlighted in the following diagram. The server provides secured key and model management capabilities. In the future the SDK will interact with device TPM and attestation service to prove device identity with the server to retrieve protected keys or models.

![Architecture](./imgs/architecture.png)


## Provision a new server
The Secured Model Management server relies on a number of Azure resources to operate. Please see [server topology](server-topology.md) for more details. We offer the automated scripts to provision your server instance on Azure.  

### Step 1. Provision server (TODO: change azuredeploy.json file location to the official path)

[![Deploy to Azure](https://aka.ms/deploytoazurebutton)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FJiaBaoxi%2FPublicShare%2Fmaster%2Fazuredeploy.json)

### Step 2: Update deployment using PowerShell script

#### Prerequisites

We offer a PowerShell script for server deployment. To run the script, you need:

* [Git Bash](https://git-scm.com/downloads)
* [PowerShell](https://docs.microsoft.com/en-us/powershell/scripting/install/installing-powershell?view=powershell-7)
* [Azure PowerShell Module](https://docs.microsoft.com/en-us/powershell/azure/install-az-ps?view=azps-4.6.1)

#### Update server access

1. Clone this repository
   ```bash
   git clone https://github.com/microsoft/Project-Santa-Cruz-Preview.git
   cd Project-Santa-Cruz-Preview
   ```
2. Launch PowerShell as an Administrator
   > **NOTE**: we need administrative privilege for key operations while creating the self-signed certificate.
3. Run the deployment script:
   ```bash
   cd "Sample-Scripts-and-Notebooks/Official/Secured Locker/deployment"
   ./device_identity.ps1 -vaultName <Azure Key Vault instance name generated by provision step> -subscription <Azure subscription name or id>
   ```
   For example, the following script genernates a new Service Princiapl and grant it access to  ```scz-mm1-kv``` key vault instance under ```my-subscription``` subscription.

   ```bash
    ./device_identity.ps1 -vaultName scz-mm1-kv -subscription my-subscription
    ```
4. The script then pops up a web browser for you to log in to your Azure subscription. Login to your Azure account to continue.
5. Once the script finishes, it outputs the service principal that is granted access to the Azure Key Vault service. 

   ```bash
   Santa Cruz Secred Model Management server is provisioned at:  ...
   Service Princiapl Client ID:     3f38...
   Service Princiapl Tenant ID:     72f9...
   Service Princiapl Client Secret: bf49...
   ```
   > **NOTE**: Note down the service principal credential. You'll use it to login to the Santa Cruz server later.

   #### Add TLS certificate in Gateway (TODO)

   

   ## Install Python SDK (TODO)